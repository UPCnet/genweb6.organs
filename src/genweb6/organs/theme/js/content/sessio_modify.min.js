function hideAgreement(t){$(".spinner-block").removeClass("d-none"),$.ajax({type:"POST",url:t+"/hideAgreement",success:function(){var e=$('.titleSpan span[data-agreement="'+t+'"]');0===e.length?setTimeout(()=>window.location.reload(),500):(e.remove(),$(".spinner-block").addClass("d-none"))},error:function(){$(".spinner-block").addClass("d-none")}})}function deleteElement(e,t,n){$(".spinner-block").removeClass("d-none");CSS.escape(t);$.ajax({type:"POST",url:e+"/deleteElement",data:{action:"delete",id:t,type:n},success:function(){setTimeout(()=>window.location.reload(),500)},error:function(){$(".spinner-block").addClass("d-none")}})}$(document).ready(function(){let a;$("#sortable").sortable({placeholder:"ui-state-highlight",opacity:.5,scroll:!1,start:function(e,t){a=t.item.index()},update:function(e,t){var n={};n.itemid=t.item.attr("id"),n.action="movepunt",n.delta=t.item.index()-a,$(".spinner-block").removeClass("d-none"),$.ajax({type:"POST",url:t.item.data("url")+"/@@fcmoveTable",data:n,success:function(){setTimeout(()=>window.location.reload(),500)},error:function(){$(".spinner-block").addClass("d-none")}})}}).disableSelection(),$(".sortable2").sortable({placeholder:"ui-state-highlight2",opacity:.5,scroll:!1,start:function(e,t){a=t.item.index()},update:function(e,t){var n={};n.itemid=t.item.attr("id"),n.action="movesubpunt",n.delta=t.item.index()-a,$(".spinner-block").removeClass("d-none"),$.ajax({type:"POST",url:t.item.data("url")+"/@@fcmoveTable",data:n,success:function(){setTimeout(()=>window.location.reload(),500)},error:function(){$(".spinner-block").addClass("d-none")}})}}).disableSelection(),$(".ui-sortable li").on("click",function(e){var t=$(this);t.hasClass("picked")||($(".ui-sortable li.picked").each(function(){$(this).removeClass("picked").find(".einesSpan").toggleClass("d-none"),$(this).find(".boleta").show()}),t.addClass("picked"),t.find(".einesSpan").toggleClass("d-none"),t.find(".boleta").hide())}),$(window).on("click.Bst",function(e){0<$(e.target).closest(".modal").length||0===$(e.target).closest("#sortable").length&&$(".ui-sortable li.picked").each(function(){$(this).removeClass("picked").find(".einesSpan").toggleClass("d-none"),$(this).find(".boleta").show()})});let t=$("#modalPunt"),n=(t.length&&t.on("hidden.bs.modal",function(){var e=t.find("#new-punt-title");e.length&&e.val("")}),$("#modalAcord")),o=(n.length&&n.on("hidden.bs.modal",function(){var e=n.find("#new-acord-title");e.length&&e.val("")}),$(".createPunt").on("click",function(e){e.preventDefault(),e.stopPropagation();e=$("#new-punt-title").val();e&&""!==e.trim()?($(".spinner-block").removeClass("d-none"),$.ajax({type:"POST",url:$("body").attr("data-base-url").split("?")[0].replace(/\/$/,"")+"/@@createElement",data:{action:"createPunt",name:e},success:function(){t.length&&t.modal("hide"),setTimeout(()=>window.location.reload(),500)},error:function(){$(".spinner-block").addClass("d-none"),alert("Hi ha hagut un error al crear el punt.")}})):alert("El títol no pot estar buit.")}),$(".createAcord").on("click",function(e){e.preventDefault(),e.stopPropagation();e=$("#new-acord-title").val();e&&""!==e.trim()?($(".spinner-block").removeClass("d-none"),$.ajax({type:"POST",url:$("body").attr("data-base-url").split("?")[0].replace(/\/$/,"")+"/@@createElement",data:{action:"createAcord",name:e},success:function(){n.length&&n.modal("hide"),setTimeout(()=>window.location.reload(),500)},error:function(){$(".spinner-block").addClass("d-none"),alert("Hi ha hagut un error al crear l'acord.")}})):alert("El títol no pot estar buit.")}),$("#modalConfirm")),i=(o.length&&o.on("show.bs.modal",function(e){let n=e.relatedTarget;var e=$(n).data("modal-title"),t=$(n).data("modal-body");let a=$(n).data("modal-action");o.find(".modal-title").text(e),o.find(".modal-body").text(t),o.find("#modalConfirmButton").off("click").on("click",function(){var e,t;"delete"===a?(e=$(n).data("item"),t=$(n).data("type"),deleteElement($(n).data("url"),e,t)):"hideAgreement"===a&&hideAgreement($(n).data("item")),o.modal("hide")})}),$("#modalEditTitle")),l=(i.length&&($("#sortable").on("click",".edit, .edit2",function(e){e.preventDefault(),e.stopPropagation();var e=$(this).data("id"),t=$(this).is("a")?$(this).text().trim():$(this).data("title");$("#edit-title-input").val(t),$("#edit-title-pk").val(e),i.modal("show")}),$("#saveTitleButton").on("click",function(){let e=$("#edit-title-pk").val(),t=$("#edit-title-input").val();t?($(".spinner-block").removeClass("d-none"),$.ajax({url:$(this).data("url")+"/changeTitle",type:"POST",data:{pk:e,value:t},success:function(){$('a.editTitle[data-id="'+e+'"]').text(t),$('button.edit[data-id="'+e+'"], button.edit2[data-id="'+e+'"]').data("title",t),i.modal("hide"),$(".spinner-block").addClass("d-none")},error:function(){alert("Hi ha hagut un error al desar el títol."),$(".spinner-block").addClass("d-none")}})):alert("El títol no pot estar buit.")})),$("li.defaultValue").on("click",function(){var e=$(this).find(".bi-circle-fill").css("color"),t=$(this).closest(".btn-group"),e=(t.find(".bullet-toggle > i").css({color:e}),$("#collapse-"+t.parent().parent().parent().attr("id")+" button.bullet-toggle > i").css({color:e}),t.closest(".einesSpan").parent().find(".boleta > span > i").css({color:e}),$(this).find("span").text());t.closest(".einesSpan").parent().find(".boleta > span > span").text(e)}),$(".form-buttons-send-structure-creation").on("click",function(e){$(".spinner-block").removeClass("d-none")}),$("#importPointsButton").on("click",function(e){e.preventDefault(),e.stopPropagation();var t,e=$("#manual-import-text").val();e&&""!==e.trim()?((t=$("<form>",{method:"POST",action:$("body").attr("data-base-url").split("?")[0].replace(/\/$/,"")+"/manualStructureCreation"})).append($("<input>",{type:"hidden",name:"form.widgets.message",value:e})),t.append($("<input>",{type:"hidden",name:"form.buttons.send",value:"Send"})),$("body").append(t),t.submit()):alert("El contingut no pot estar buit.")}),$("#modalPunts"));l.length&&l.on("hidden.bs.modal",function(){var e=l.find("#manual-import-text");e.length&&e.val("")})});