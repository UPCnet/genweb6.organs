function hideAgreement(e){$.ajax({type:"POST",url:e+"/hideAgreement",success:function(){var t=$('.titleSpan span[data-agreement="'+e+'"]');0===t.length?setTimeout(()=>window.location.reload(),500):t.remove()}})}function deleteElement(t,e,a){CSS.escape(e);$.ajax({type:"POST",url:t+"/deleteElement",data:{action:"delete",id:e,type:a},success:function(){setTimeout(()=>window.location.reload(),500)}})}$(document).ready(function(){let n;$("#sortable").sortable({placeholder:"ui-state-highlight",opacity:.5,scroll:!1,start:function(t,e){n=e.item.index()},update:function(t,e){var a={};a.itemid=e.item.attr("id"),a.action="movepunt",a.delta=e.item.index()-n,$.ajax({type:"POST",url:e.item.data("url")+"/@@fcmoveTable",data:a,success:function(){setTimeout(()=>window.location.reload(),500)}})}}).disableSelection(),$(".sortable2").sortable({placeholder:"ui-state-highlight2",opacity:.5,scroll:!1,start:function(t,e){n=e.item.index()},update:function(t,e){var a={};a.itemid=e.item.attr("id"),a.action="movesubpunt",a.delta=e.item.index()-n,$.ajax({type:"POST",url:e.item.data("url")+"/@@fcmoveTable",data:a,success:function(){setTimeout(()=>window.location.reload(),500)}})}}).disableSelection(),$(".ui-sortable li").on("click",function(t){var e=$(this);e.hasClass("picked")||($(".ui-sortable li.picked").each(function(){$(this).removeClass("picked").find(".einesSpan").toggleClass("d-none"),$(this).find(".boleta").show()}),e.addClass("picked"),e.find(".einesSpan").toggleClass("d-none"),e.find(".boleta").hide())}),$(window).on("click.Bst",function(t){0<$(t.target).closest(".modal").length||0===$(t.target).closest("#sortable").length&&$(".ui-sortable li.picked").each(function(){$(this).removeClass("picked").find(".einesSpan").toggleClass("d-none"),$(this).find(".boleta").show()})});let e=$("#modalPunt"),a=(e.length&&e.on("hidden.bs.modal",function(){var t=e.find("#new-punt-title");t.length&&t.val("")}),$("#modalAcord")),i=(a.length&&a.on("hidden.bs.modal",function(){var t=a.find("#new-acord-title");t.length&&t.val("")}),$(".createPunt").on("click",function(t){t.preventDefault(),t.stopPropagation();t=$("#new-punt-title").val();t&&""!==t.trim()?$.ajax({type:"POST",url:window.location.href.split("?")[0].replace(/\/$/,"")+"/@@createElement",data:{action:"createPunt",name:t},success:function(){e.length&&e.modal("hide"),setTimeout(()=>window.location.reload(),500)},error:function(){alert("Hi ha hagut un error al crear el punt.")}}):alert("El títol no pot estar buit.")}),$(".createAcord").on("click",function(t){t.preventDefault(),t.stopPropagation();t=$("#new-acord-title").val();t&&""!==t.trim()?$.ajax({type:"POST",url:window.location.href.split("?")[0].replace(/\/$/,"")+"/@@createElement",data:{action:"createAcord",name:t},success:function(){a.length&&a.modal("hide"),setTimeout(()=>window.location.reload(),500)},error:function(){alert("Hi ha hagut un error al crear l'acord.")}}):alert("El títol no pot estar buit.")}),$("#modalConfirm")),o=(i.length&&i.on("show.bs.modal",function(t){let a=t.relatedTarget;var t=$(a).data("modal-title"),e=$(a).data("modal-body");let n=$(a).data("modal-action");i.find(".modal-title").text(t),i.find(".modal-body").text(e),i.find("#modalConfirmButton").off("click").on("click",function(){var t,e;"delete"===n?(t=$(a).data("item"),e=$(a).data("type"),deleteElement($(a).data("url"),t,e)):"hideAgreement"===n&&hideAgreement($(a).data("item")),i.modal("hide")})}),$("#modalEditTitle")),l=(o.length&&($("#sortable").on("click",".edit, .edit2",function(t){t.preventDefault(),t.stopPropagation();var t=$(this).data("id"),e=$(this).is("a")?$(this).text().trim():$(this).data("title");$("#edit-title-input").val(e),$("#edit-title-pk").val(t),o.modal("show")}),$("#saveTitleButton").on("click",function(){let t=$("#edit-title-pk").val(),e=$("#edit-title-input").val();e?$.ajax({url:$(this).data("url")+"/changeTitle",type:"POST",data:{pk:t,value:e},success:function(){$('a.editTitle[data-id="'+t+'"]').text(e),$('button.edit[data-id="'+t+'"], button.edit2[data-id="'+t+'"]').data("title",e),o.modal("hide")},error:function(){alert("Hi ha hagut un error al desar el títol.")}}):alert("El títol no pot estar buit.")})),$("li.defaultValue").on("click",function(){var t=$(this).find(".bi-circle-fill").css("color"),e=$(this).closest(".btn-group"),t=(e.find(".bullet-toggle > i").css({color:t}),$("#collapse-"+e.parent().parent().parent().attr("id")+" button.bullet-toggle > i").css({color:t}),e.closest(".einesSpan").parent().find(".boleta > span > i").css({color:t}),$(this).find("span").text());e.closest(".einesSpan").parent().find(".boleta > span > span").text(t)}),$("#importPointsButton").on("click",function(t){t.preventDefault(),t.stopPropagation();var e,t=$("#manual-import-text").val();t&&""!==t.trim()?((e=$("<form>",{method:"POST",action:window.location.href.split("?")[0].replace(/\/$/,"")+"/manualStructureCreation"})).append($("<input>",{type:"hidden",name:"form.widgets.message",value:t})),e.append($("<input>",{type:"hidden",name:"form.buttons.send",value:"Send"})),$("body").append(e),e.submit()):alert("El contingut no pot estar buit.")}),$("#modalPunts"));l.length&&l.on("hidden.bs.modal",function(){var t=l.find("#manual-import-text");t.length&&t.val("")})});