let START_YEAR=2016,CURRENT_YEAR=(new Date).getFullYear(),PAGE_SIZE=50;function generateYearFilterHTML(){let e='<option value="">Tots els anys</option>';for(let a=CURRENT_YEAR;a>=START_YEAR;a--)e+=`<option value="${a}" ${a===CURRENT_YEAR?"selected":""}>${a}</option>`;return e}let currentAcordsPage=1,currentAcordsYear=CURRENT_YEAR;function loadAcords(a,e=null){$(".spinner-acords-tab").removeClass("d-none"),$("#acordsTbody").empty(),$("#acordsPagination").empty();a=new URLSearchParams({page:a,page_size:PAGE_SIZE});e&&a.append("year",e),$.ajax({type:"GET",url:$(location).attr("href")+"/getAcordsOrgangovern?"+a.toString(),success:function(a){a=$.parseJSON(a);updateAcordsStats(a.total,a.page,a.page_size),a.items&&0<a.items.length?($.each(a.items,function(a,e){var t="<tr>",t=(t=(t+='<td style="vertical-align: middle;">')+'<i class="bi bi-check me-1" aria-hidden="True"></i>'+('<a href="'+e.absolute_url+'">'+e.title+"</a>"))+"</td>"+'<td class="text-center align-middle">';e.agreement&&(t+="<span>"+e.agreement+"</span>"),t=(t=(t+="</td>")+'<td style="min-width: 100px" class="text-center align-middle"><span class="estatpunt"><i class="bi bi-circle-fill boletaGran" aria-hidden="true" style="color: '+e.color+';"></i> ')+"<span> "+e.estatsLlista+"</span></span></td></tr>",$("#acordsTbody").append(t)}),1<a.total_pages&&renderPagination("#acordsPagination",a.total_pages,a.page,function(a){loadAcords(currentAcordsPage=a,currentAcordsYear)},"#acords-tab-panel")):$("#acordsTbody").append('<tr><td colspan="3" class="text-center text-muted">No hi ha acords</td></tr>'),$(".spinner-acords-tab").addClass("d-none")},error:function(){$("#acordsTbody").html('<tr><td colspan="3" class="text-center text-danger">Error al carregar els acords.</td></tr>'),$(".spinner-acords-tab").addClass("d-none")}})}function updateAcordsStats(a,e,t){var s=0===a?0:(e-1)*t+1,e=Math.min(e*t,a),t=0===a?"No hi ha acords":`Mostrant ${s} - ${e} de ${a} acords`;$("#acords-stats").html("<small>"+t+"</small>")}let currentSessionsPage=1,currentSessionsYear=CURRENT_YEAR;function loadSessions(a,e=null){$(".spinner-sessions-tab").removeClass("d-none"),$("#sessionsTbody").empty(),$("#sessionsPagination").empty();a=new URLSearchParams({page:a,page_size:PAGE_SIZE});e&&a.append("year",e),$.ajax({type:"GET",url:$(location).attr("href")+"/getSessionsOrgangovern?"+a.toString(),success:function(a){a=$.parseJSON(a);updateSessionsStats(a.total,a.page,a.page_size),a.items&&0<a.items.length?($.each(a.items,function(a,e){var t="<tr>",t=(t=(t=(t=(t=(t=(t=(t+='<td style="vertical-align: middle;">')+'<i class="bi bi-list" aria-hidden="True"></i>'+('<a href="'+e.absolute_url+'">'+e.title+"</a>"))+(' [<span class="fs-s">'+e.sessionNumber+"</span>]")+"</td>")+'<td class="text-center align-middle">'+("<span>"+e.dataSessio+"</span><br/>"))+("<span>"+e.horaInici+"</span>")+"</td>")+'<td class="text-center align-middle">'+("<span>"+e.llocConvocatoria+"</span>"))+"</td>"+'<td class="text-center align-middle">')+('<span class="label-'+e.review_state+'">'+e.review_state_title+"</span>")+"</td></tr>";$("#sessionsTbody").append(t)}),1<a.total_pages&&renderPagination("#sessionsPagination",a.total_pages,a.page,function(a){loadSessions(currentSessionsPage=a,currentSessionsYear)},"#sessions-tab-panel")):$("#sessionsTbody").append('<tr><td colspan="4" class="text-center text-muted">No hi ha sessions</td></tr>'),$(".spinner-sessions-tab").addClass("d-none")},error:function(){$("#sessionsTbody").html('<tr><td colspan="4" class="text-center text-danger">Error al carregar les sessions.</td></tr>'),$(".spinner-sessions-tab").addClass("d-none")}})}function updateSessionsStats(a,e,t){var s=0===a?0:(e-1)*t+1,e=Math.min(e*t,a),t=0===a?"No hi ha sessions":`Mostrant ${s} - ${e} de ${a} sessions`;$("#sessions-stats").html("<small>"+t+"</small>")}let currentActesPage=1,currentActesYear=CURRENT_YEAR;function loadActes(a,e=null){$(".spinner-actas-tab").removeClass("d-none"),$("#actesTbody").empty(),$("#actesPagination").empty();a=new URLSearchParams({page:a,page_size:PAGE_SIZE});e&&a.append("year",e),$.ajax({type:"GET",url:$(location).attr("href")+"/getActesOrgangovern?"+a.toString(),success:function(a){a=$.parseJSON(a);updateActesStats(a.total,a.page,a.page_size),a.items&&0<a.items.length?($.each(a.items,function(a,e){var t="<tr>",t=(t=(t+="<td>")+'<i class="bi bi-file-text me-1" aria-hidden="true"></i>'+('<a href="'+e.absolute_url+'">'+e.title+"</a>"))+"</td>"+'<td class="text-center">';e.data&&(t+="<span>"+e.data+"</span>"),t+="</td></tr>",$("#actesTbody").append(t)}),1<a.total_pages&&renderPagination("#actesPagination",a.total_pages,a.page,function(a){loadActes(currentActesPage=a,currentActesYear)},"#actas-tab-panel")):$("#actesTbody").append('<tr><td colspan="2" class="text-center text-muted">No hi ha actes</td></tr>'),$(".spinner-actas-tab").addClass("d-none")},error:function(){$("#actesTbody").html('<tr><td colspan="2" class="text-center text-danger">Error al carregar les actes.</td></tr>'),$(".spinner-actas-tab").addClass("d-none")}})}function updateActesStats(a,e,t){var s=0===a?0:(e-1)*t+1,e=Math.min(e*t,a),t=0===a?"No hi ha actes":`Mostrant ${s} - ${e} de ${a} actes`;$("#actes-stats").html("<small>"+t+"</small>")}function renderPagination(a,e,t,s,n){let r='<nav aria-label="PaginaciÃ³"><ul class="pagination mb-0">';r=(r+=`<li class="page-item ${1===t?"disabled":""}">`)+`<a class="page-link" href="#" data-page="${t-1}" aria-label="Anterior">`+'<span aria-hidden="true">&laquo;</span></a></li>';let i=Math.max(1,t-Math.floor(2.5));var l=Math.min(e,i+5-1);1<(i=l-i<4?Math.max(1,l-5+1):i)&&(r+='<li class="page-item"><a class="page-link" href="#" data-page="1">1</a></li>',2<i)&&(r+='<li class="page-item disabled"><span class="page-link">...</span></li>');for(let a=i;a<=l;a++)r=(r+=`<li class="page-item ${a===t?"active":""}">`)+`<a class="page-link" href="#" data-page="${a}">${a}</a></li>`;l<e&&(l<e-1&&(r+='<li class="page-item disabled"><span class="page-link">...</span></li>'),r+=`<li class="page-item"><a class="page-link" href="#" data-page="${e}">${e}</a></li>`),r=(r=r+`<li class="page-item ${t===e?"disabled":""}">`+`<a class="page-link" href="#" data-page="${t+1}" aria-label="Siguiente">`)+'<span aria-hidden="true">&raquo;</span></a></li></ul></nav>',$(a).html(r),$(a+" .page-link").on("click",function(a){a.preventDefault();var a=$(this);a.parent().hasClass("disabled")||a.parent().hasClass("active")||0<(a=parseInt(a.data("page")))&&a<=e&&(s(a),$("html, body").animate({scrollTop:$(n).offset().top-100},300))})}$(document).ready(function(){var a=generateYearFilterHTML();$("#sessions-year-filter").html(a),$("#sessions-year-filter").val(CURRENT_YEAR),$("#sessions-year-filter").on("change",function(){currentSessionsYear=$(this).val()||null,loadSessions(currentSessionsPage=1,currentSessionsYear)}),loadSessions(1,CURRENT_YEAR),$("#year-filter").html(a),$("#year-filter").val(CURRENT_YEAR),$("#year-filter").on("change",function(){currentAcordsYear=$(this).val()||null,loadAcords(currentAcordsPage=1,currentAcordsYear)}),$("#actes-year-filter").html(a),$("#actes-year-filter").val(CURRENT_YEAR),$("#actes-year-filter").on("change",function(){currentActesYear=$(this).val()||null,loadActes(currentActesPage=1,currentActesYear)})}),$("#acords-tab").on("click",function(){loadAcords(1,currentAcordsYear),$("#acords-tab").unbind("click")}),$("#actes-tab").on("click",function(){loadActes(1,currentActesYear),$("#actes-tab").unbind("click")});