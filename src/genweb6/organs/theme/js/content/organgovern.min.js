let currentAcordsPage=1,currentAcordsYear=(new Date).getFullYear(),acordsMinYear=null,acordsFilterInitialized=!1;function initYearFilter(e=null,a=null){var t=(new Date).getFullYear();const r=a||t,s=e||2010;let n='<option value="">Tots els anys</option>';for(let e=r;e>=s;e--)n+=`<option value="${e}" ${e===t?"selected":""}>${e}</option>`;$("#year-filter").html(n),$("#year-filter").off("change").on("change",function(){currentAcordsYear=$(this).val(),loadAcords(currentAcordsPage=1,currentAcordsYear)}),t>=s&&t<=r&&(currentAcordsYear=t,loadAcords(1,currentAcordsYear))}function loadAcords(a,e=null){$(".spinner-acords-tab").removeClass("d-none"),$("#acordsTbody").empty(),$("#acordsPagination").empty();a=new URLSearchParams({page:a,page_size:50});e&&a.append("year",e),$.ajax({type:"GET",url:$(location).attr("href")+"/getAcordsOrgangovern?"+a.toString(),success:function(a){if(a=$.parseJSON(a),!acordsFilterInitialized&&a.min_year&&a.max_year)return initYearFilter(a.min_year,a.max_year),void(acordsFilterInitialized=!0);updateAcordsStats(a.total,a.page,a.page_size),a.items&&0<a.items.length?($.each(a.items,function(a,e){var t="<tr>",t=(t=(t=(t+='<td style="vertical-align: middle;">')+'<i class="bi bi-check me-1" aria-hidden="True"></i>'+('<a href="'+e.absolute_url+'">'))+e.title+"</a>")+"</td>"+'<td class="text-center align-middle">';t=(t=(t=(e.agreement?(t+="<span>")+e.agreement+"</span>":t)+'</td><td style="min-width: 100px" class="text-center align-middle">')+'<span class="estatpunt"><i class="bi bi-circle-fill boletaGran" aria-hidden="true" style="color: '+e.color+';"></i> ')+"<span> "+e.estatsLlista+"</span></span></td></tr>",$("#acordsTbody").append(t)}),1<a.total_pages&&renderAcordsPagination(a.total_pages,a.page)):$("#acordsTbody").append('<tr><td colspan="3" class="text-center text-muted">No hi ha acords</td></tr>'),$(".spinner-acords-tab").addClass("d-none")},error:function(){$("#acordsTbody").html('<tr><td colspan="3" class="text-center text-danger">Error al carregar els acords.</td></tr>'),$(".spinner-acords-tab").addClass("d-none")}})}function updateAcordsStats(a,e,t){var r=0===a?0:(e-1)*t+1,e=Math.min(e*t,a);let s="<small>";s=s+(0===a?"No hi ha acords":`Mostrant ${r} - ${e} de ${a} acords`)+"</small>",$("#acords-stats").html(s)}function renderAcordsPagination(e,t){let r='<nav aria-label="Paginació acords"><ul class="pagination mb-0">';r=(r=r+`<li class="page-item ${1===t?"disabled":""}">`+`<a class="page-link" href="#" data-page="${t-1}" aria-label="Anterior">`)+'<span aria-hidden="true">&laquo;</span></a></li>';let s=Math.max(1,t-Math.floor(2.5));var n=Math.min(e,s+4);1<(s=n-s<4?Math.max(1,n-4):s)&&(r=(r+='<li class="page-item">')+'<a class="page-link" href="#" data-page="1">1</a></li>',2<s)&&(r+='<li class="page-item disabled"><span class="page-link">...</span></li>');for(let a=s;a<=n;a++)r=(r+=`<li class="page-item ${a===t?"active":""}">`)+`<a class="page-link" href="#" data-page="${a}">${a}</a>`+"</li>";n<e&&(n<e-1&&(r+='<li class="page-item disabled"><span class="page-link">...</span></li>'),r=(r+='<li class="page-item">')+`<a class="page-link" href="#" data-page="${e}">${e}</a>`+"</li>"),r=(r=(r+=`<li class="page-item ${t===e?"disabled":""}">`)+`<a class="page-link" href="#" data-page="${t+1}" aria-label="Siguiente">`+'<span aria-hidden="true">&raquo;</span>')+"</a></li></ul></nav>",$("#acordsPagination").html(r),$("#acordsPagination .page-link").on("click",function(a){a.preventDefault();var a=$(this);a.parent().hasClass("disabled")||a.parent().hasClass("active")||0<(a=parseInt(a.data("page")))&&a<=e&&(loadAcords(currentAcordsPage=a,currentAcordsYear),$("html, body").animate({scrollTop:$("#acords-tab-panel").offset().top-100},300))})}let currentSessionsPage=1,currentSessionsYear=(new Date).getFullYear(),sessionsFilterInitialized=!1;function initSessionsYearFilter(e=null,a=null){var t=(new Date).getFullYear();const r=a||t,s=e||2010;let n='<option value="">Tots els anys</option>';for(let e=r;e>=s;e--)n+=`<option value="${e}" ${e===t?"selected":""}>${e}</option>`;$("#sessions-year-filter").html(n),$("#sessions-year-filter").off("change").on("change",function(){currentSessionsYear=$(this).val(),loadSessions(currentSessionsPage=1,currentSessionsYear)}),t>=s&&t<=r&&(currentSessionsYear=t,loadSessions(1,currentSessionsYear))}function loadSessions(a,e=null){$(".spinner-sessions-tab").removeClass("d-none"),$("#sessionsTbody").empty(),$("#sessionsPagination").empty();a=new URLSearchParams({page:a,page_size:50});e&&a.append("year",e),$.ajax({type:"GET",url:$(location).attr("href")+"/getSessionsOrgangovern?"+a.toString(),success:function(a){if(a=$.parseJSON(a),!sessionsFilterInitialized&&a.min_year&&a.max_year)return initSessionsYearFilter(a.min_year,a.max_year),void(sessionsFilterInitialized=!0);updateSessionsStats(a.total,a.page,a.page_size),a.items&&0<a.items.length?($.each(a.items,function(a,e){var t="<tr>",t=(t=(t=(t=(t=(t=(t=(t=(t+='<td style="vertical-align: middle;">')+'<i class="bi bi-list" aria-hidden="True"></i>'+('<a href="'+e.absolute_url+'">'))+e.title+"</a>")+" [<span class=\"fs-s\">"+e.sessionNumber+"</span>]")+"</td>"+'<td class="text-center align-middle">')+"<span>"+e.dataSessio+"</span>")+"<br/>")+"<span>"+e.horaInici+"</span>")+"</td>"+'<td class="text-center align-middle">';t=(t=(t=(t+="<span>"+e.llocConvocatoria+"</span>")+"</td>"+'<td class="text-center align-middle">')+'<span class="label-'+e.review_state+'">'+e.review_state+"</span>")+"</td></tr>",$("#sessionsTbody").append(t)}),1<a.total_pages&&renderSessionsPagination(a.total_pages,a.page)):$("#sessionsTbody").append('<tr><td colspan="4" class="text-center text-muted">No hi ha sessions</td></tr>'),$(".spinner-sessions-tab").addClass("d-none")},error:function(){$("#sessionsTbody").html('<tr><td colspan="4" class="text-center text-danger">Error al carregar les sessions.</td></tr>'),$(".spinner-sessions-tab").addClass("d-none")}})}function updateSessionsStats(a,e,t){var r=0===a?0:(e-1)*t+1,e=Math.min(e*t,a);let s="<small>";s=s+(0===a?"No hi ha sessions":`Mostrant ${r} - ${e} de ${a} sessions`)+"</small>",$("#sessions-stats").html(s)}function renderSessionsPagination(e,t){let r='<nav aria-label="Paginació sessions"><ul class="pagination mb-0">';r=(r=r+`<li class="page-item ${1===t?"disabled":""}">`+`<a class="page-link" href="#" data-page="${t-1}" aria-label="Anterior">`)+'<span aria-hidden="true">&laquo;</span></a></li>';let s=Math.max(1,t-Math.floor(2.5));var n=Math.min(e,s+4);1<(s=n-s<4?Math.max(1,n-4):s)&&(r+='<li class="page-item"><a class="page-link" href="#" data-page="1">1</a></li>',2<s)&&(r+='<li class="page-item disabled"><span class="page-link">...</span></li>');for(let a=s;a<=n;a++)r=(r+=`<li class="page-item ${a===t?"active":""}">`)+`<a class="page-link" href="#" data-page="${a}">${a}</a>`+"</li>";n<e&&(n<e-1&&(r+='<li class="page-item disabled"><span class="page-link">...</span></li>'),r+=`<li class="page-item"><a class="page-link" href="#" data-page="${e}">${e}</a></li>`),r=(r=(r+=`<li class="page-item ${t===e?"disabled":""}">`)+`<a class="page-link" href="#" data-page="${t+1}" aria-label="Siguiente">`+'<span aria-hidden="true">&raquo;</span>')+"</a></li></ul></nav>",$("#sessionsPagination").html(r),$("#sessionsPagination .page-link").on("click",function(a){a.preventDefault();var a=$(this);a.parent().hasClass("disabled")||a.parent().hasClass("active")||0<(a=parseInt(a.data("page")))&&a<=e&&(loadSessions(currentSessionsPage=a,currentSessionsYear),$("html, body").animate({scrollTop:$("#sessions-tab-panel").offset().top-100},300))})}$(document).ready(function(){loadSessions(1,null)}),$("#acords-tab").on("click",function(){loadAcords(1,null),$("#acords-tab").unbind("click")}),$("#actes-tab").on("click",function(){$(".spinner-actas-tab").removeClass("d-none"),$.ajax({type:"GET",url:$(location).attr("href")+"/getActesOrgangovern",success:function(a){data=$.parseJSON(a),$.each(data,function(a,e){var t="<tr>",t=(t=(t=(t+="<td>")+'<i class="bi bi-file-text me-1" aria-hidden="true"></i>'+('<a href="'+e.absolute_url+'">'))+e.title+"</a>")+"</td>"+'<td class="text-center">';t=(e.data?(t+="<span>")+e.data+"</span>":t)+"</td></tr>",$("#actesTbody").append(t)}),$(".spinner-actas-tab").addClass("d-none")}}),$("#actes-tab").unbind("click")});
