const START_YEAR=2016,CURRENT_YEAR=(new Date).getFullYear(),PAGE_SIZE=50;function generateYearFilterHTML(){let e='<option value="">Tots els anys</option>';for(let a=CURRENT_YEAR;a>=START_YEAR;a--)e+=`<option value="${a}" ${a===CURRENT_YEAR?"selected":""}>${a}</option>`;return e}let currentAcordsPage=1,currentAcordsYear=CURRENT_YEAR;function loadAcords(e,a=null){$(".spinner-acords-tab").removeClass("d-none"),$("#acordsTbody").empty(),$("#acordsPagination").empty();const t=new URLSearchParams({page:e,page_size:PAGE_SIZE});a&&t.append("year",a),$.ajax({type:"GET",url:$(location).attr("href")+"/getAcordsOrgangovern?"+t.toString(),success:function(e){const a=$.parseJSON(e);updateAcordsStats(a.total,a.page,a.page_size),a.items&&a.items.length>0?($.each(a.items,function(e,a){let t="<tr>";t+='<td style="vertical-align: middle;">';t+='<i class="bi bi-check me-1" aria-hidden="True"></i>';t+='<a href="'+a.absolute_url+'">'+a.title+"</a>";t+="</td>";t+='<td class="text-center align-middle">';if(a.agreement)t+="<span>"+a.agreement+"</span>";t+="</td>";t+='<td style="min-width: 100px" class="text-center align-middle">';t+='<span class="estatpunt"><i class="bi bi-circle-fill boletaGran" aria-hidden="true" style="color: '+a.color+';"></i> ';t+="<span> "+a.estatsLlista+"</span></span>";t+="</td></tr>";$("#acordsTbody").append(t)}),a.total_pages>1&&renderPagination("#acordsPagination",a.total_pages,a.page,function(e){currentAcordsPage=e,loadAcords(e,currentAcordsYear)},"#acords-tab-panel")):$("#acordsTbody").append('<tr><td colspan="3" class="text-center text-muted">No hi ha acords</td></tr>'),$(".spinner-acords-tab").addClass("d-none")},error:function(){$("#acordsTbody").html('<tr><td colspan="3" class="text-center text-danger">Error al carregar els acords.</td></tr>'),$(".spinner-acords-tab").addClass("d-none")}})}function updateAcordsStats(e,a,t){const r=0===e?0:(a-1)*t+1,s=Math.min(a*t,e),n=0===e?"No hi ha acords":"Mostrant "+r+" - "+s+" de "+e+" acords";$("#acords-stats").html("<small>"+n+"</small>")}let currentSessionsPage=1,currentSessionsYear=CURRENT_YEAR;function loadSessions(e,a=null){$(".spinner-sessions-tab").removeClass("d-none"),$("#sessionsTbody").empty(),$("#sessionsPagination").empty();const t=new URLSearchParams({page:e,page_size:PAGE_SIZE});a&&t.append("year",a),$.ajax({type:"GET",url:$(location).attr("href")+"/getSessionsOrgangovern?"+t.toString(),success:function(e){const a=$.parseJSON(e);updateSessionsStats(a.total,a.page,a.page_size),a.items&&a.items.length>0?($.each(a.items,function(e,a){let t="<tr>";t+='<td style="vertical-align: middle;">';t+='<i class="bi bi-list" aria-hidden="True"></i>';t+='<a href="'+a.absolute_url+'">'+a.title+"</a>";t+=' [<span class="fs-s">'+a.sessionNumber+"</span>]";t+="</td>";t+='<td class="text-center align-middle">';t+="<span>"+a.dataSessio+"</span><br/>";t+="<span>"+a.horaInici+"</span>";t+="</td>";t+='<td class="text-center align-middle">';t+="<span>"+a.llocConvocatoria+"</span>";t+="</td>";t+='<td class="text-center align-middle">';t+='<span class="label-'+a.review_state+'">'+a.review_state+"</span>";t+="</td></tr>";$("#sessionsTbody").append(t)}),a.total_pages>1&&renderPagination("#sessionsPagination",a.total_pages,a.page,function(e){currentSessionsPage=e,loadSessions(e,currentSessionsYear)},"#sessions-tab-panel")):$("#sessionsTbody").append('<tr><td colspan="4" class="text-center text-muted">No hi ha sessions</td></tr>'),$(".spinner-sessions-tab").addClass("d-none")},error:function(){$("#sessionsTbody").html('<tr><td colspan="4" class="text-center text-danger">Error al carregar les sessions.</td></tr>'),$(".spinner-sessions-tab").addClass("d-none")}})}function updateSessionsStats(e,a,t){const r=0===e?0:(a-1)*t+1,s=Math.min(a*t,e),n=0===e?"No hi ha sessions":"Mostrant "+r+" - "+s+" de "+e+" sessions";$("#sessions-stats").html("<small>"+n+"</small>")}let currentActesPage=1,currentActesYear=CURRENT_YEAR;function loadActes(e,a=null){$(".spinner-actas-tab").removeClass("d-none"),$("#actesTbody").empty(),$("#actesPagination").empty();const t=new URLSearchParams({page:e,page_size:PAGE_SIZE});a&&t.append("year",a),$.ajax({type:"GET",url:$(location).attr("href")+"/getActesOrgangovern?"+t.toString(),success:function(e){const a=$.parseJSON(e);updateActesStats(a.total,a.page,a.page_size),a.items&&a.items.length>0?($.each(a.items,function(e,a){let t="<tr>";t+="<td>";t+='<i class="bi bi-file-text me-1" aria-hidden="true"></i>';t+='<a href="'+a.absolute_url+'">'+a.title+"</a>";t+="</td>";t+='<td class="text-center">';if(a.data)t+="<span>"+a.data+"</span>";t+="</td></tr>";$("#actesTbody").append(t)}),a.total_pages>1&&renderPagination("#actesPagination",a.total_pages,a.page,function(e){currentActesPage=e,loadActes(e,currentActesYear)},"#actas-tab-panel")):$("#actesTbody").append('<tr><td colspan="2" class="text-center text-muted">No hi ha actes</td></tr>'),$(".spinner-actas-tab").addClass("d-none")},error:function(){$("#actesTbody").html('<tr><td colspan="2" class="text-center text-danger">Error al carregar les actes.</td></tr>'),$(".spinner-actas-tab").addClass("d-none")}})}function updateActesStats(e,a,t){const r=0===e?0:(a-1)*t+1,s=Math.min(a*t,e),n=0===e?"No hi ha actes":"Mostrant "+r+" - "+s+" de "+e+" actes";$("#actes-stats").html("<small>"+n+"</small>")}function renderPagination(e,a,t,r,s){let n='<nav aria-label="PaginaciÃ³"><ul class="pagination mb-0">';n+='<li class="page-item '+(1===t?"disabled":"")+'"><a class="page-link" href="#" data-page="'+(t-1)+'" aria-label="Anterior"><span aria-hidden="true">&laquo;</span></a></li>';let i=Math.max(1,t-2),l=Math.min(a,i+4);l-i<4&&(i=Math.max(1,l-4));i>1&&(n+='<li class="page-item"><a class="page-link" href="#" data-page="1">1</a></li>',i>2&&(n+='<li class="page-item disabled"><span class="page-link">...</span></li>'));for(let e=i;e<=l;e++)n+='<li class="page-item '+(e===t?"active":"")+'"><a class="page-link" href="#" data-page="'+e+'">'+e+"</a></li>";l<a&&(l<a-1&&(n+='<li class="page-item disabled"><span class="page-link">...</span></li>'),n+='<li class="page-item"><a class="page-link" href="#" data-page="'+a+'">'+a+"</a></li>");n+='<li class="page-item '+(t===a?"disabled":"")+'"><a class="page-link" href="#" data-page="'+(t+1)+'" aria-label="Siguiente"><span aria-hidden="true">&raquo;</span></a></li></ul></nav>';$(e).html(n),$(e+" .page-link").on("click",function(e){e.preventDefault();const n=$(this);if(!n.parent().hasClass("disabled")&&!n.parent().hasClass("active")){const e=parseInt(n.data("page"));e>0&&e<=a&&(r(e),$("html, body").animate({scrollTop:$(s).offset().top-100},300))}})}$(document).ready(function(){const e=generateYearFilterHTML();$("#sessions-year-filter").html(e),$("#sessions-year-filter").val(CURRENT_YEAR),$("#sessions-year-filter").on("change",function(){currentSessionsYear=$(this).val()||null,currentSessionsPage=1,loadSessions(1,currentSessionsYear)}),loadSessions(1,CURRENT_YEAR),$("#year-filter").html(e),$("#year-filter").val(CURRENT_YEAR),$("#year-filter").on("change",function(){currentAcordsYear=$(this).val()||null,currentAcordsPage=1,loadAcords(1,currentAcordsYear)}),$("#actes-year-filter").html(e),$("#actes-year-filter").val(CURRENT_YEAR),$("#actes-year-filter").on("change",function(){currentActesYear=$(this).val()||null,currentActesPage=1,loadActes(1,currentActesYear)})}),$("#acords-tab").on("click",function(){loadAcords(1,currentAcordsYear),$("#acords-tab").unbind("click")}),$("#actes-tab").on("click",function(){loadActes(1,currentActesYear),$("#actes-tab").unbind("click")});
