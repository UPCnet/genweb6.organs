<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ca"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      lang="ca"
      metal:use-macro="context/main_template/macros/master"
      i18n:domain="genweb6.organs">
<body>

<div metal:fill-slot="main" tal:condition="view/canView"
     tal:define="membresConvocats context/membresConvocats;
                 membresConvidats context/membresConvidats;
                 llistaExcusats context/llistaExcusats;
                 llistaNoAssistens context/llistaNoAssistens;
                 assistents context/assistents;
                 ordenDelDia context/ordenDelDia;
                 llocConvocatoria context/llocConvocatoria;
                 horaFi view/horaFi;
                 horaInici view/horaInici;
                 audio view/AudioInside;
                 annexes view/AnnexInside;
                 enllacVideo context/enllacVideo;
                 absolute_url context/absolute_url;
                 hasFirma view/hasFirma;
                 checkSerieGDoc view/checkSerieGDoc;
                 isSigned view/isSigned;">

  <div class="container my-4">
    <h1 class="documentFirstHeading mb-4" tal:content="view/title">Annex</h1>

    <tal:block tal:condition="checkSerieGDoc/visible_gdoc">
      <div class="alert alert-warning alert-dismissible fade show" role="alert" tal:condition="not:checkSerieGDoc/valid_serie">
        <strong>Error</strong>
        <tal:block tal:content="checkSerieGDoc/msg_error"></tal:block>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
    </tal:block>

    <tal:block tal:condition="not:checkSerieGDoc/visible_gdoc">
      <div class="alert alert-warning alert-dismissible fade show" role="alert" tal:condition="checkSerieGDoc/msg_error">
        <strong>Error</strong>
        <tal:block tal:content="checkSerieGDoc/msg_error"></tal:block>
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
    </tal:block>

    <!-- <div id="infoSend" class="alert alert-warning alert-dismissible fade show" role="alert">
      <strong>Info</strong>
      <tal:block>Aquesta acció pot trigar una estona. El procés de signatura continuarà independentment de que aquesta pantalla pugui donar timeout. Si en uns minuts torneu a aquesta pàgina apareixerà l'estat de l'acta ja processada en el portafirmes.</tal:block>
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div> -->

    <!-- Barra d'accions -->
    <div class="d-flex justify-content-end mb-3 gap-2">
      <tal:block tal:condition="not:view/isSigned">
        <a id="printActaBtn"
          class="btn btn-outline-primary"
          tal:condition="view/viewPrintButon"
          href="#"
          tal:attributes="data-url string:${absolute_url}">
          <i class="bi bi-printer me-1"></i>
          <span i18n:translate="">Imprimir</span>
        </a>

        <iframe id="printActaIframe" name="printActaIframe" style="display:none;width:0;height:0;border:0;" src=""></iframe>

        <a id="previewActaBtn"
          class="btn btn-outline-primary"
          tal:condition="view/viewPrintButon"
          tal:attributes="data-url string:${absolute_url}/previewActa"
          href="#">
          <i class="bi bi-eye me-1"></i>
          <span i18n:translate="">Previsualitza</span>
        </a>
      </tal:block>

      <tal:block tal:condition="view/isSigned">
        <a class="btn btn-outline-primary btnActa"
            tal:attributes="href string:${absolute_url}/viewActa;">
          <i class="bi bi-eye me-1"></i>
          <span i18n:translate="">Acta signada</span>
        </a>
      </tal:block>
    </div>


    <!-- Estat firma -->
    <tal:block tal:condition="not:view/isAnon">
      <div tal:condition="hasFirma" class="mb-3">
        <span tal:define="estatFirma view/estatFirma"
              tal:attributes="class string:py-2 px-3 rounded-pill rounded-pill estat-firma text-bg-${estatFirma/class} fw-bold fs-xs">
          <tal:block i18n:translate="">Acta: </tal:block>
          <tal:block tal:replace="estatFirma/text">PENDENT_SIGNANTS</tal:block>
        </span>
      </div>
    </tal:block>

    <ul class="nav nav-tabs mb-2" id="actaTabs" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="dades-tab" data-bs-toggle="tab" data-bs-target="#dades" type="button" role="tab">
          <span i18n:translate="">Dades</span>
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="assistents-tab" data-bs-toggle="tab" data-bs-target="#assistents" type="button" role="tab">
          <span i18n:translate="">Relacio Assistents</span>
        </button>
      </li>
    </ul>

    <div class="tab-content" id="actaTabContent">

      <!-- Dades -->
      <div class="tab-pane fade show active" id="dades" role="tabpanel" aria-labelledby="dades-tab">
        <div class="card">
          <div class="card-body">
            <ul class="list-unstyled">
              <li tal:condition="horaInici">
                <strong i18n:translate="Session start time">Session start time</strong>:
                <span tal:content="horaInici" />
              </li>
              <li tal:condition="horaFi">
                <strong i18n:translate="Session end time">Session end time</strong>:
                <span tal:content="horaFi" />
              </li>
              <li tal:condition="llocConvocatoria">
                <strong i18n:translate="">Lloc</strong>:
                <span tal:content="llocConvocatoria" />
              </li>
              <li tal:condition="enllacVideo">
                <strong i18n:translate="Video link">Video link</strong>:
                <a tal:attributes="href enllacVideo; target string:_blank"><span i18n:translate="">Video</span></a>
              </li>
              <li tal:condition="audio">
                <strong i18n:translate="Audio de la sessio">Audio de la sessio</strong>:
                <ul class="list-unstyled">
                  <tal:repeat repeat="item audio">
                    <li class="mb-2">
                      <i class="bi bi-file-earmark-music"></i>
                      <a tal:attributes="href item/absolute_url" tal:content="item/title">audio</a>
                      <audio class="d-block mt-1 w-100" controls tal:attributes="src item/download_url"></audio>
                    </li>
                  </tal:repeat>
                </ul>
              </li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Assistents -->
      <div class="tab-pane fade" id="assistents" role="tabpanel" aria-labelledby="assistents-tab">

        <!-- Sub-pestañas para la relación d'assistents -->
        <ul class="nav nav-tabs mb-2" id="assistSubTabs" role="tablist">
          <li class="nav-item" tal:condition="membresConvocats" role="presentation">
            <button class="nav-link active" id="tab-assistents" data-bs-toggle="pill" data-bs-target="#pane-assistents" type="button" role="tab">
              <span i18n:translate="">Assistants</span>
            </button>
          </li>
          <li class="nav-item" tal:condition="membresConvidats" role="presentation">
            <button tal:attributes="class view/getNavConvidatsClass"
                    id="tab-convidats" data-bs-toggle="pill" data-bs-target="#pane-convidats" type="button" role="tab">
              <span i18n:translate="">Invited members</span>
            </button>
          </li>
          <li class="nav-item" tal:condition="llistaExcusats" role="presentation">
            <button tal:attributes="class view/getNavExcusatsClass"
                    id="tab-excusats" data-bs-toggle="pill" data-bs-target="#pane-excusats" type="button" role="tab">
              <span i18n:translate="">Excused members</span>
            </button>
          </li>
          <li class="nav-item" tal:condition="llistaNoAssistens" role="presentation">
            <button tal:attributes="class view/getNavNoassistClass"
                    id="tab-noassist" data-bs-toggle="pill" data-bs-target="#pane-noassist" type="button" role="tab">
              <span i18n:translate="">No assistents</span>
            </button>
          </li>
        </ul>

        <div class="tab-content" id="assistSubTabContent">
          <div class="tab-pane fade show active" id="pane-assistents" role="tabpanel" aria-labelledby="tab-assistents" tal:condition="membresConvocats">
            <div class="card">
              <div class="card-body">
                <span tal:replace="structure membresConvocats/output"/>
              </div>
            </div>
          </div>
          <div tal:attributes="class view/getPaneConvidatsClass"
               id="pane-convidats" role="tabpanel" aria-labelledby="tab-convidats" tal:condition="membresConvidats">
            <div class="card">
              <div class="card-body">
                <span tal:replace="structure membresConvidats/output"/>
              </div>
            </div>
          </div>
          <div tal:attributes="class view/getPaneExcusatsClass"
               id="pane-excusats" role="tabpanel" aria-labelledby="tab-excusats" tal:condition="llistaExcusats">
            <div class="card">
              <div class="card-body">
                <span tal:replace="structure llistaExcusats/output"/>
              </div>
            </div>
          </div>
          <div tal:attributes="class view/getPaneNoassistClass"
               id="pane-noassist" role="tabpanel" aria-labelledby="tab-noassist" tal:condition="llistaNoAssistens">
            <div class="card">
              <div class="card-body">
                <span tal:replace="structure llistaNoAssistens/output"/>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Ordre del dia -->
    <div class="mt-3" tal:condition="ordenDelDia" tal:content="structure ordenDelDia/output"></div>

    <!-- Annexes & Acta PDF -->
    <tal:block tal:condition="not:isSigned">
      <div class="mt-5" tal:condition="annexes">
        <h2 class="mb-2" tal:condition="view/hasMultipleAnnexes" i18n:translate="">Fitxers adjunts</h2>
        <h2 class="mb-2" tal:condition="not:view/hasMultipleAnnexes" i18n:translate="">Fitxer adjunt</h2>
        <ul class="list-unstyled">
          <tal:repeat repeat="item annexes">
            <li>
              <i class="bi bi-paperclip"></i>
              <a tal:attributes="href string:${item/absolute_url}/@@display-file/file/" tal:content="item/filename">annex</a>
              <span class="text-muted fs-s ms-2">(<span tal:replace="item/sizeKB_rounded"></span> KB)</span>
              <a tal:attributes="href string:${item/absolute_url}/@@download/file/${item/filename}" class="ms-1"><i class="bi bi-download"></i></a>
            </li>
          </tal:repeat>
        </ul>
      </div>

      <div class="mt-5" tal:condition="context/acta">
        <h2 class="mb-2" i18n:translate="">Acta PDF</h2>
        <p>
          <i class="bi bi-file-earmark-pdf me-1"></i>
          <a tal:attributes="href string:${absolute_url}/@@display-file/acta/; target string:_blank" tal:content="context/acta/filename">acta</a>
          <span class="text-muted fs-s ms-2">
            (<span tal:replace="view/getActaUnsignedSizeRounded"></span> KB)
          </span>
          <a tal:attributes="href string:${absolute_url}/@@download/acta/${context/acta/filename}" class="ms-2">
            <i class="bi bi-download"></i>
          </a>
        </p>
      </div>
    </tal:block>

    <tal:block tal:condition="isSigned" tal:define="acta view/getPFDActa">
      <div class="mt-5" tal:condition="annexes">
        <h2 class="mb-2" tal:condition="view/hasMultipleAnnexes" i18n:translate="">Fitxers adjunts</h2>
        <h2 class="mb-2" tal:condition="not:view/hasMultipleAnnexes" i18n:translate="">Fitxer adjunt</h2>
        <ul class="list-unstyled">
          <tal:repeat repeat="item annexes">
            <li>
              <i class="bi bi-paperclip"></i>
              <a tal:attributes="href item/absolute_url" tal:content="item/filename">annex</a>
              <span class="text-muted fs-s ms-2">
                (<span tal:replace="item/sizeKB_rounded"></span> KB)
              </span>
              <a tal:attributes="href item/download_url" class="ms-1"><i class="bi bi-download"></i></a>
            </li>
          </tal:repeat>
        </ul>
      </div>

      <div class="mt-5" tal:condition="acta">
        <h2 class="mb-2" tal:condition="view/isSigned" i18n:translate="">Acta signada</h2>
        <p>
          <i class="bi bi-file-earmark-pdf me-1"></i>
          <a tal:attributes="href string:${absolute_url}/viewActa" tal:content="acta/filename">acta</a>
          <span class="text-muted fs-s ms-2">
            (<span tal:replace="view/getActaSizeRounded"></span> KB)
          </span>
          <a tal:attributes="href string:${absolute_url}/downloadActa;" class="ms-2">
            <i class="bi bi-download"></i>
          </a>
        </p>
      </div>
    </tal:block>
  </div>

  <!-- Modal Previsualització Acta -->
  <div class="modal fade" id="previewActaModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-xl modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h2 class="modal-title" i18n:translate="">Previsualització de l'acta</h2>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body" id="previewActaBody">
          <!-- Contingut carregat via AJAX -->
        </div>
      </div>
    </div>
  </div>

  <script defer src="++theme++genweb6.organs/js/content/acta.min.js" ></script>

</div>

</body>
</html>
